# =============================================================================
# Render Blueprint for HN Herald FastAPI Application
# =============================================================================
# Documentation: https://render.com/docs/blueprint-spec
#
# Deployment Instructions:
# 1. Connect your GitHub repository to Render.com
# 2. Create a new "Blueprint" and point to this render.yaml
# 3. Set the required environment variables in Render dashboard:
#    - ANTHROPIC_API_KEY: Your Anthropic API key for LLM summarization
# 4. Deploy!
#
# Manual Deployment:
#   render blueprint apply
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # Primary Web Service - FastAPI Application
  # ---------------------------------------------------------------------------
  - type: web
    name: hn-herald
    runtime: python
    plan: free
    region: oregon
    branch: main

    # Auto-deploy on push to main branch
    autoDeploy: true

    # Build Configuration
    # Install uv package manager, then sync dependencies (production only)
    buildCommand: |
      pip install uv &&
      uv sync --frozen --no-dev --no-install-project

    # Start Command
    # Run uvicorn with production settings
    # Note: Render provides $PORT automatically
    startCommand: |
      uv run uvicorn hn_herald.main:app --host 0.0.0.0 --port $PORT --workers 1

    # Health Check Configuration
    # Render will poll this endpoint to verify service health
    healthCheckPath: /api/health

    # Environment Variables
    envVars:
      # -----------------------------------------------------------------------
      # Required: API Keys (set via Render Dashboard - never commit secrets!)
      # -----------------------------------------------------------------------
      - key: ANTHROPIC_API_KEY
        sync: false  # Must be set manually in Render dashboard

      # -----------------------------------------------------------------------
      # Application Configuration
      # -----------------------------------------------------------------------
      - key: HN_HERALD_ENV
        value: production

      - key: HN_HERALD_DEBUG
        value: "false"

      - key: HN_HERALD_LOG_LEVEL
        value: INFO

      # -----------------------------------------------------------------------
      # LangGraph/LangChain Settings
      # -----------------------------------------------------------------------
      - key: LANGCHAIN_TRACING_V2
        value: "false"  # Set to "true" and add LANGCHAIN_API_KEY for tracing

      # Optional: LangSmith tracing (uncomment and set in dashboard)
      # - key: LANGCHAIN_API_KEY
      #   sync: false

      # -----------------------------------------------------------------------
      # Python Runtime Configuration
      # -----------------------------------------------------------------------
      - key: PYTHON_VERSION
        value: "3.12"

      - key: PYTHONUNBUFFERED
        value: "1"
